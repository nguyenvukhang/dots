#!/usr/bin/env sh
# vim:syntax=bash
#
# It is the responsibility of the user to make sure that this script
# is called from the directory that this script is located in.

submodules() {
  git submodule update --init
  git submodule foreach git checkout main
}

OS="$(uname)" ARCH="$(arch)"

# bootstrap homebrew on a mac
if [ $OS = 'Darwin' ] && ! command -v brew >/dev/null; then
  # arm64 and non-arm archs on mac have different homebrew paths
  [ $ARCH = 'arm64' ] && PREFIX='/opt/homebrew' || PREFIX='/usr/local'
  [ ! -f $PREFIX/bin/brew ] && echo 'brew not found ._.' && exit 1
  # clutch a brew link
  eval "$($PREFIX/bin/brew shellenv)"
fi

# check that stow is installed
if ! command -v stow >/dev/null; then
  echo 'stow not found ._.' && exit 1
fi

# stow --restow -t ~ @
stow --restow -t ~/.config/tmux -d @/tmux
stow --restow -t ~/.config/zsh -d @/zsh
stow --restow -t ~/.config/nvim -d @/nvim
stow --restow -t ~/.config/alacritty -d @/alacritty
stow --restow -t ~/.config/git -d @/git
# stow --restow -t ~/.config -d @ zsh
# stow --restow -t ~/.config -d @ nvim
# stow --restow -t ~/.config -d @ alacritty
# stow --restow -t ~/.config -d @ git

# <Here>
# .
# └── @
#    ├── zsh
#    ├── git
#    └── nvim

# <Deployment>
# ~
# └── .config
#    ├── zsh
#    ├── git
#    └── nvim
