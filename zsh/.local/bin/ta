#!/usr/bin/env zsh

# tmux attach script: ta

t="${1-uni}" # default value: "base"

typeset -A start_dir=(
  [base]="$HOME"
  [uni]="$HOME/repos/uni"
  [sun]="$HOME/sunnus/app/dev"
)

function tmux_new() {
  local s=$start_dir[$t]
  [ $s ] && c=$s || c=$HOME
  tmux new-session -d -s $t -c $c -n server
}

if [ -z "$TMUX" ]; then # when outside of tmux
  if ! tmux has-session -t "$t" 2>/dev/null; then
    # if session doesn't exist, create it
    tmux_new
  fi
  tmux attach -t $t:server; return
else # when inside of tmux
  if ! tmux has-session -t $t 2>/dev/null; then
    # if target doesn't exist,
    # just start a new session first
    tmux_new
  fi
  tmux switch-client -t $t:server; return
fi
