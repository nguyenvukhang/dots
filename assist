#!/bin/zsh

function submodule_init() {
  git submodule update --init --recursive
  repo_folders=(
    zsh
    walls
    pass/.password-store
    nvim/.config/nvim
    personal
    raspberry-pi
  )

  p=$PWD
  for i in $repo_folders; do
    [ ! -d $p/$i ] && continue
    cd $p/$i
    echo "----------\n$i"
    git checkout master
  done
  echo '----------'
}

function lua_build() {
  cd personal/lua-language-server
  cd 3rd/luamake
  ./compile/install.sh
  cd ../..
  ./3rd/luamake/luamake rebuild
}

function generate_uninstaller() {
  local setup=$(cat setup)
  echo ${setup//--restow/--delete} > uninstall
}

function mac_setup() {
  defaults write -g InitialKeyRepeat -int 16 # normal minimum is 15 (225 ms)
  defaults write -g KeyRepeat -int 2 # normal minimum is 2 (30 ms)

  # Enable Dock Hiding
  defaults write com.apple.dock autohide -bool true

  # Set Dock Size
  defaults write com.apple.dock tilesize -int 1

  # Disable Dock Icon Bounce
  defaults write com.apple.dock no-bouncing -bool false

  # Lock Dock Size
  defaults write com.apple.Dock size-immutable -bool yes && \
  killall Dock

  # Show Hidden Files in Finder
  defaults write com.apple.finder AppleShowAllFiles true

  # Show the hidden Library directory in Finder
  chflags nohidden ~/Library

  # Disable rubber band scrolling
  defaults write -g NSScrollViewRubberbanding -bool false
}

function brew_clutch() {
  echo "eval \"\$(/opt/homebrew/bin/brew shellenv)\"" > $HOME/.zprofile
}

case $1 in
  "--sub"|"-S") submodule_init;;
  "--lua"|"-L") lua_build;;
  "--gen"|"-G") generate_uninstaller;;
  "--mac"|"-M") mac_setup;;
  "--brew"|"-B") brew_clutch;;
  "") echo "TODO: create a simple help message";;
esac
